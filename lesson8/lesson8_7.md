# lesson8_7.py 說明

## 檔案用途

此檔案建立一個 Gradio 使用者介面，讓使用者輸入文字並選擇輸出風格（例如：口語化、小學、商業、條列式、專業），再呼叫外部模型（透過 `client.models.generate_content` 或相似 API）產生結果並以 Markdown 顯示。

## 主要元件

- `style_radio`：風格選項。
- `input_text`：使用者多行文字輸入欄位。
- `output_md`：用於呈現模型回應的 Markdown 元件。
- `summarize(style, text)`：由 `input_text.submit` 或按鈕觸發，將風格與文字組成 prompt，呼叫模型並回傳顯示結果。

## summarize 函式行為（摘要）

1. 根據 `style` 參數選擇相對應的提示語（prompt prefix），例如：
   - 口語化 -> `請使用口語化的風格\n`
   - 小學 -> `請使用小學生看的懂的語法\n`
   - 商業 -> `請使用商業文章的風格\n`
   - 條列式 -> `請條列式重點\n`
   - 專業 -> `請使用專業的風格\n`
2. 將風格提示與使用者 `text` 組合後，呼叫模型 API（如 `client.models.generate_content`）。
3. 將模型回傳內容顯示於 `output_md`。

## 注意事項

- 風格名稱需與 UI 中顯示的值一致；建議在程式內使用 dict 映射來避免拼字或字符問題。
- `client`（或其他模型連線物件）必須在程式中正確初始化，包含 API key、endpoint 等設定，否則會發生例外。
- 模型呼叫可能耗時，建議加入載入狀態指示、timeout、重試與例外處理，並在 UI 顯示明確錯誤訊息。
- 當接受使用者自由輸入並直接拼接到 prompt 時，需注意 prompt 注入風險與輸入安全性（視情境而定）。

## 改進建議

- 使用映射表替換多重 if/elif，提高可維護性：

```python
style_map = {
    "口語化": "請使用口語化的風格\n",
    "小學": "請使用小學生看的懂的語法\n",
    "商業": "請使用商業文章的風格\n",
    "條列式": "請條列式重點\n",
    "專業": "請使用專業的風格\n",
}
prompt = style_map.get(style, "") + text
```

- 將模型呼叫封裝成一個可注入的函式或物件，方便 unit test 時 mock 模型回應。
- 若 UI 會公開部署，記得不要在程式中硬編 API key，改以環境變數或安全的設定檔載入。

## 執行與測試

- 執行（假設 `lesson8_7.py` 會啟動 Gradio）：

```bash
python lesson8_7.py
```

- 測試要點：
  - 確認風格選項顯示正確且能選擇。
  - 輸入文字送出後 UI 有載入提示且最後顯示模型回應。
  - 當 `client` 未設定或 API 錯誤時，UI 應顯示錯誤訊息而非崩潰。

## 常見錯誤與排查

- NameError: `client` 未定義 -> 檢查是否有正確初始化 client 或載入相關設定。
- UI 無回應或卡住 -> 檢查模型呼叫是否為同步阻塞；增加非同步處理或顯示進度。
- 輸出風格不正確 -> 檢查選單值是否與程式中比對的字串一致，或 prompt 組合是否正確。

---

如果您需要，我可以：
- 幫您把 `summarize` 改寫為使用映射表的更清晰實作，並加入錯誤處理。
- 在 `lesson8_7.py` 中加入載入提示、timeout 與簡單的例外處理範例。
- 幫您把 `lesson8_7.md` 加入到 `README` 或其他文件索引中。

請告訴我您要下一步做哪一項。
